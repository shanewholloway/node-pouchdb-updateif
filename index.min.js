'use strict';var _deepEqual=void 0;try{_deepEqual=require('deep-equal')}catch(err){(function(){var assert=require('assert');_deepEqual=function _deepEqual(a,b){try{return assert.deepEqual(a,b),true}catch(err){return false}}})()}Object.assign(exports,{updateWith:function updateWith(obj,applyFn){var _this=this;if('string'===typeof obj)obj={_id:obj};if('function'!==typeof applyFn)throw new Error('Parameter `applyFn` is required and must be a function');return this.get(obj._id).then(function(current){var _ref=current?current:{},_id=_ref._id,_rev=_ref._rev;if(!obj._rev)obj._rev=_rev;var ans=applyFn(obj,current,_rev);if(!ans)return ans;if(!ans._id)ans._id=_id;if(!ans._rev&&_id===ans._id)ans._rev=_rev;return ans},function(err){if(err.status!==404)throw err;var ans=applyFn?applyFn(obj,null,null):obj;return ans}).then(function(ans){return ans?_this.put(ans):null})},updateIf:function updateIf(obj,filterFn){return this.updateWith(obj,function(obj,current){return filterFn(obj,current)?obj:null})},overwrite:function overwrite(obj){return this.updateWith(obj,function(obj){return obj})},replace:function replace(obj){return this.overwrite(obj)},updateAssign:function updateAssign(obj){return this.updateWith(obj,function(obj,current){return current?Object.assign(current,obj):obj})},updateOrMerge:function updateOrMerge(obj){return this.updateAssign(obj)},_checkNewVersion:function _checkNewVersion(obj,current){return!current||obj.version>current.version},updateByVersion:function updateByVersion(obj,checkNewVersion){if(!checkNewVersion)checkNewVersion=this._checkNewVersion;return this.updateIf(obj,checkNewVersion)},_checkChanged:function _checkChanged(obj,current){return!current||!_deepEqual(obj,current)},updateIfChanged:function updateIfChanged(obj,checkChanged){if(!checkChanged)checkChanged=this._checkChanged;return this.updateIf(obj,checkChanged)}});
